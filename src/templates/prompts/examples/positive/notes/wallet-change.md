Highlights:
- Seeded randomness drives the wallet makeup, guarantees at least one bill and some coin value, and selects a purchase price strictly below both the total cash and bill-only subtotal so regrouping remains meaningful.
- Choice generation tags every distractor with a misconception (`IGNORE_COINS`, `NO_BORROW`, `MISVALUE_COINS`, offsets), filters duplicates, and keeps all amounts positive—making the diagnostic space both intentional and deterministic.
- Math helpers (`mathDollar`, `mathMoneyExpr`, `formatCents`) unify how amounts render in the stem, interactions, and feedback, ensuring the same values appear in both MathML and text narration.
- Feedback preambles quote the learner’s computed dollar amount and explain the misconception, while the shared three-step plan mirrors the subtraction algorithm: tally starting cash, set up subtraction with regrouping logic, then compute cents and dollars before revealing the solution.
- Each preamble now follows the global checklist verbatim: it repeats the learner’s exact dollar choice, exposes the specific evidence (e.g., “ignores the coins worth $0.37”, “uses |43−58| cents”), and states the rule (borrow when top cents are smaller, value each coin correctly).
- The catch-all offset branch reports how far the choice is from the true difference and reminds the learner when to regroup, so even generic offsets deliver actionable corrections.
- All intermediate arithmetic now labels dollars and cents explicitly—clickable MathML arrows (`→ $0.89`, `→ $17.00`) make it obvious how the raw subtraction translates into currency, so the learner sees the symbolic math and the money amount in one glance.
